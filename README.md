# üìß –ò–º—ç–π–ª –±–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª–∞–ª—Ç—Ç–∞–π Chatwoot Chatbot

–≠–Ω—ç —Å–∏—Å—Ç–µ–º –Ω—å —Ö—ç—Ä—ç–≥–ª—ç–≥—á–¥—ç—ç—Å —ç—Ö–ª—ç—ç–¥ –∏–º—ç–π–ª —Ö–∞—è–≥–∞–∞ –±–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª–∞—Ö—ã–≥ —à–∞–∞—Ä–¥–∞–∂, –¥–∞—Ä–∞–∞ –Ω—å OpenAI Assistant-—Ç–æ–π —Ö–∞—Ä–∏–ª—Ü–∞—Ö –±–æ–ª–æ–º–∂–∏–π–≥ –æ–ª–≥–æ–¥–æ–≥.

## üöÄ –°–∏—Å—Ç–µ–º–∏–π–Ω –∞–∂–∏–ª–ª–∞–≥–∞–∞

1. **–•—ç—Ä—ç–≥–ª—ç–≥—á Chatwoot chatbot-–¥ –º–µ—Å—Å–µ–∂ –±–∏—á–Ω—ç**
2. **–°–∏—Å—Ç–µ–º–∞ –∏–º—ç–π–ª —Ö–∞—è–≥ —à–∞–∞—Ä–¥–∞–Ω–∞**
3. **–•—ç—Ä—ç–≥–ª—ç–≥—á –∏–º—ç–π–ª—ç—ç –æ—Ä—É—É–ª–Ω–∞**
4. **–°–∏—Å—Ç–µ–º–∞ —Ç—É—Ö–∞–π–Ω –∏–º—ç–π–ª —Ä“Ø“Ø –±–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª–∞—Ö –ª–∏–Ω–∫ –∏–ª–≥—ç—ç–Ω—ç**
5. **–•—ç—Ä—ç–≥–ª—ç–≥—á –ª–∏–Ω–∫ –¥—ç—ç—Ä –¥–∞—Ä–∂ –±–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª–Ω–∞**
6. **–ë–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª—Å–Ω—ã –¥–∞—Ä–∞–∞ chatbot –∞–∂–∏–ª–ª–∞–∂ —ç—Ö—ç–ª–Ω—ç**

## üìã –®–∞–∞—Ä–¥–ª–∞–≥–∞—Ç–∞–π –∑“Ø–π–ª—Å

### Python packages

```bash
pip install -r requirements.txt
```

### –û—Ä—á–Ω—ã —Ö—É–≤—å—Å–∞–≥—á–∏–¥

`env_example.txt` —Ñ–∞–π–ª—ã–≥ `.env` –±–æ–ª–≥–æ–Ω —Ö—É—É–ª–∂, –¥–∞—Ä–∞–∞—Ö –º—ç–¥—ç—ç–ª–ª–∏–π–≥ –æ—Ä—É—É–ª–Ω–∞ —É—É:

- **OpenAI**: API key –±–æ–ª–æ–Ω Assistant ID
- **Chatwoot**: API key –±–æ–ª–æ–Ω Account ID
- **Gmail**: –ò–º—ç–π–ª –±–æ–ª–æ–Ω App Password
- **JWT Secret**: –ê—é—É–ª–≥“Ø–π —Ç“Ø–ª—Ö“Ø“Ø—Ä “Ø–≥
- **Verification URL**: –¢–∞–Ω—ã —Å–µ—Ä–≤—ç—Ä–∏–π–Ω —Ö–∞—è–≥

### Gmail —Ç–æ—Ö–∏—Ä–≥–æ–æ

1. Gmail –¥—ç—ç—Ä 2-Factor Authentication –∏–¥—ç–≤—Ö–∂“Ø“Ø–ª—ç—Ö
2. App Password “Ø“Ø—Å–≥—ç—Ö
3. `SENDER_EMAIL` –±–æ–ª–æ–Ω `SENDER_PASSWORD` —Ç–æ—Ö–∏—Ä—É—É–ª–∞—Ö

## üîß –°—É—É–ª–≥–∞—Ö –∑–∞–∞–≤–∞—Ä

```bash
# 1. Repository –∫–ª–æ–Ω —Ö–∏–π—Ö
git clone <your-repo>
cd <your-repo>

# 2. Dependencies —Å—É—É–ª–≥–∞—Ö
pip install -r requirements.txt

# 3. Environment variables —Ç–æ—Ö–∏—Ä—É—É–ª–∞—Ö
cp env_example.txt .env
# .env —Ñ–∞–π–ª—ã–≥ –∑–∞—Å–≤–∞—Ä–ª–∞–∂ ”©”©—Ä–∏–π–Ω –º—ç–¥—ç—ç–ª–ª—ç—ç—Ä –¥“Ø“Ø—Ä–≥—ç—Ö

# 4. –°–µ—Ä–≤–µ—Ä–∏–π–≥ –∞–∂–∏–ª–ª—É—É–ª–∞—Ö
python main.py
```

## üì° Webhook —Ç–æ—Ö–∏—Ä–≥–æ–æ

Chatwoot –¥—ç—ç—Ä webhook URL —Ç–æ—Ö–∏—Ä—É—É–ª–∞—Ö:

```
http://your-domain.com/webhook
```

## üéØ –ê—à–∏–≥–ª–∞—Ö –∑–∞–∞–≤–∞—Ä

### –•—ç—Ä—ç–≥–ª—ç–≥—á–∏–π–Ω —Ö—É–≤—å–¥:

1. Chatwoot chatbot-–¥ –¥—É—Ä—ã–Ω –º–µ—Å—Å–µ–∂ –±–∏—á–∏—Ö
2. "–ó”©–≤ –∏–º—ç–π–ª —Ö–∞—è–≥–∞–∞ –±–∏—á—ç—ç–¥ –∏–ª–≥—ç—ç–Ω—ç “Ø“Ø" –≥—ç—Ö –º–µ—Å—Å–µ–∂ –∏—Ä–Ω—ç
3. –ò–º—ç–π–ª —Ö–∞—è–≥–∞–∞ –±–∏—á–∏—Ö (–∂–∏—à—ç—ç: `user@gmail.com`)
4. "–ò–º—ç–π–ª —Ä“Ø“Ø –±–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª–∞—Ö –ª–∏–Ω–∫ –∏–ª–≥—ç—ç–ª—ç—ç" –≥—ç—Ö –º–µ—Å—Å–µ–∂ –∏—Ä–Ω—ç
5. –ò–º—ç–π–ª—ç—ç —à–∞–ª–≥–∞–∞–¥ –ª–∏–Ω–∫ –¥—ç—ç—Ä –¥–∞—Ä–∞—Ö
6. "–ê–º–∂–∏–ª—Ç—Ç–∞–π –±–∞—Ç–∞–ª–≥–∞–∞–∂–ª–∞–∞" —Ö—É—É–¥–∞—Å —Ö–∞—Ä–∞–≥–¥–∞–Ω–∞
7. Chatwoot –¥—ç—ç—Ä "–¢–∞–Ω—ã –∏–º—ç–π–ª –±–∞—Ç–∞–ª–≥–∞–∞–∂–ª–∞–∞!" –º–µ—Å—Å–µ–∂ –∏—Ä–Ω—ç
8. –û–¥–æ–æ chatbot-—Ç–æ–π —á–∞—Ç–ª–∞–∂ –±–æ–ª–Ω–æ

### –¢–µ—Ö–Ω–∏–∫–∏–π–Ω –¥—ç–ª–≥—ç—Ä—ç–Ω–≥“Ø–π:

- –•—ç—Ä—ç–≥–ª—ç–≥—á –±“Ø—Ä ”©”©—Ä–∏–π–Ω OpenAI thread-—Ç—ç–π
- –ò–º—ç–π–ª –±–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª–∞—Ö —Ç–æ–∫–µ–Ω 24 —Ü–∞–≥–∏–π–Ω –¥–∞—Ä–∞–∞ –¥—É—É—Å–Ω–∞
- Chatwoot conversation –¥—ç—ç—Ä `email_verified` –±–æ–ª–æ–Ω `verified_contact_{contact_id}` —Ö–∞–¥–≥–∞–ª–∞–≥–¥–∞–Ω–∞

## üîí –ê—é—É–ª–≥“Ø–π –±–∞–π–¥–∞–ª

- JWT —Ç–æ–∫–µ–Ω –∞—à–∏–≥–ª–∞–Ω –∏–º—ç–π–ª –±–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª–∞—Ö
- –¢–æ–∫–µ–Ω 24 —Ü–∞–≥–∏–π–Ω –¥–∞—Ä–∞–∞ –∞–≤—Ç–æ–º–∞—Ç–∞–∞—Ä –¥—É—É—Å–Ω–∞
- –•—ç—Ä—ç–≥–ª—ç–≥—á —Ç—É—Å –±“Ø—Ä–∏–π–Ω thread —Ç—É—Å–≥–∞–∞—Ä–ª–∞–≥–¥–º–∞–ª
- –ò–º—ç–π–ª format —à–∞–ª–≥–∞–≥–¥–¥–∞–≥

## üêõ –ê–ª–¥–∞–∞ –∑–∞—Å–≤–∞—Ä–ª–∞—Ö

–•—ç—Ä—ç–≤ –∞—Å—É—É–¥–∞–ª –≥–∞—Ä–≤–∞–ª:

1. Console –ª–æ–≥—É—É–¥—ã–≥ —à–∞–ª–≥–∞—Ö
2. Environment variables –∑”©–≤ —Ç–æ—Ö–∏—Ä—É—É–ª—Å–∞–Ω —ç—Å—ç—Ö–∏–π–≥ —à–∞–ª–≥–∞—Ö
3. Gmail App Password –∑”©–≤ –∞—à–∏–≥–ª–∞–∂ –±–∞–π–≥–∞–∞ —ç—Å—ç—Ö–∏–π–≥ —à–∞–ª–≥–∞—Ö
4. Chatwoot webhook URL –∑”©–≤ —Ç–æ—Ö–∏—Ä—É—É–ª—Å–∞–Ω —ç—Å—ç—Ö–∏–π–≥ —à–∞–ª–≥–∞—Ö

## üìû –î—ç–º–∂–ª—ç–≥

–ê—Å—É—É–ª—Ç –±–∞–π–≤–∞–ª issue “Ø“Ø—Å–≥—ç–Ω—ç “Ø“Ø.

# Chatwoot AI Chatbot + RAG –î–æ–∫—É–º–µ–Ω—Ç –°–∏—Å—Ç–µ–º

## –ï—Ä”©–Ω—Ö–∏–π —Ç–æ–π–º

–≠–Ω—ç —Å–∏—Å—Ç–µ–º –Ω—å **Chatwoot** –ø–ª–∞—Ç—Ñ–æ—Ä–º–¥ –∑–æ—Ä–∏—É–ª—Å–∞–Ω **AI chatbot** –±”©–≥”©”©–¥ **RAG (Retrieval-Augmented Generation)** —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏ –∞—à–∏–≥–ª–∞–Ω –¥–æ–∫—É–º–µ–Ω—Ç—ã–Ω —Ö–∞–π–ª—Ç—ã–≥ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏ —Ö–∏–π—Å—ç–Ω —é–º. –°–∏—Å—Ç–µ–º –Ω—å —Ö—ç—Ä—ç–≥–ª—ç–≥—á–∏–π–Ω –∞—Å—É—É–ª—Ç—ã–≥ –∞–≤—Ç–æ–º–∞—Ç–∞–∞—Ä —Ö–∞—Ä–∏—É–ª–∂, —à–∞–∞—Ä–¥–ª–∞–≥–∞—Ç–∞–π “Ø–µ–¥ –∞–∂–∏–ª—Ç–∞–Ω–¥ –¥–∞–º–∂—É—É–ª–¥–∞–≥.

## –ì–æ–ª –æ–Ω—Ü–ª–æ–≥—É—É–¥

### ü§ñ AI Chatbot

- **OpenAI Assistant API** –∞—à–∏–≥–ª–∞–Ω —Ö—ç—Ä—ç–≥–ª—ç–≥—á—Ç—ç–π –∞–≤—Ç–æ–º–∞—Ç —Ö–∞—Ä–∏–ª—Ü–∞—Ö
- –ò–º—ç–π–ª –±–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª–∞–ª—Ç —à–∞–∞—Ä–¥–∞—Ö
- Microsoft Teams-—ç—ç—Ä –∞–∂–∏–ª—Ç–∞–Ω–¥ –º—ç–¥—ç—ç–ª—ç—Ö
- Retry –º–µ—Ö–∞–Ω–∏–∑–º –±–æ–ª–æ–Ω –∞–ª–¥–∞–∞ —É–¥–∏—Ä–¥–ª–∞–≥–∞

### üìö RAG –î–æ–∫—É–º–µ–Ω—Ç –°–∏—Å—Ç–µ–º

- **LangChain + FAISS** –∞—à–∏–≥–ª–∞–Ω –≤–µ–∫—Ç–æ—Ä—ã–Ω —Ö–∞–π–ª—Ç
- –î–æ–∫—É–º–µ–Ω—Ç —Å–∞–π—Ç–∞–∞—Å –∞–≤—Ç–æ–º–∞—Ç –º—ç–¥—ç—ç–ª—ç–ª —Ü—É–≥–ª—É—É–ª–∞—Ö
- –•—ç—Ä—ç–≥–ª—ç–≥—á–∏–π–Ω –∞—Å—É—É–ª—Ç—ã–≥ –¥–æ–∫—É–º–µ–Ω—Ç–∞–∞—Å —Ö–∞–π–∂ —Ö–∞—Ä–∏—É–ª–∞—Ö
- Source links-—Ç—ç–π —Ö–∞—Ä–∏—É–ª—Ç ”©–≥”©—Ö

### üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏ –æ–Ω—Ü–ª–æ–≥—É—É–¥

- –î–æ–∫—É–º–µ–Ω—Ç—ã–Ω –∞—Å—É—É–ª—Ç –±–æ–ª RAG —Å–∏—Å—Ç–µ–º –∞—à–∏–≥–ª–∞—Ö
- –ï—Ä”©–Ω—Ö–∏–π –∞—Å—É—É–ª—Ç –±–æ–ª AI Assistant –∞—à–∏–≥–ª–∞—Ö
- –ê–≤—Ç–æ–º–∞—Ç —Å–∏—Å—Ç–µ–º–∞ —Å–æ–Ω–≥–æ–ª—Ç
- Teams –º—ç–¥—ç—ç–ª—ç–ª –∑”©–≤—Ö”©–Ω AI Assistant-–¥

## API Endpoints

### “Æ–Ω–¥—Å—ç–Ω endpoints

- `POST /webhook` - Chatwoot webhook handler
- `GET /verify` - –ò–º—ç–π–ª –±–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª–∞–ª—Ç
- `GET /health` - –°–∏—Å—Ç–µ–º–∏–π–Ω health check

### RAG —Å–∏—Å—Ç–µ–º–∏–π–Ω endpoints

- `POST /docs-search` - –î–æ–∫—É–º–µ–Ω—Ç —Ö–∞–π–ª—Ç—ã–Ω —Ç—É—Å–¥–∞–∞ API
- `POST /rebuild-docs` - –î–æ–∫—É–º–µ–Ω—Ç—ã–Ω vector store –¥–∞—Ö–∏–Ω –±“Ø—Ç—ç—ç—Ö

### –¢–µ—Å—Ç endpoints

- `GET /test-teams` - Teams –º—ç–¥—ç—ç–ª—ç–ª —Ç–µ—Å—Ç

## –°—É—É–ª–≥–∞—Ö –∑–∞–∞–≤–∞—Ä

### 1. Dependencies —Å—É—É–ª–≥–∞—Ö

```bash
pip install -r requirements.txt
```

### 2. –û—Ä—á–Ω—ã —Ö—É–≤—å—Å–∞–≥—á–∏–¥ —Ç–æ—Ö–∏—Ä—É—É–ª–∞—Ö

```bash
# OpenAI —Ç–æ—Ö–∏—Ä–≥–æ–æ
OPENAI_API_KEY=sk-...
ASSISTANT_ID=asst_...

# Chatwoot —Ç–æ—Ö–∏—Ä–≥–æ–æ
CHATWOOT_API_KEY=your_chatwoot_token
ACCOUNT_ID=1

# Email —Ç–æ—Ö–∏—Ä–≥–æ–æ
SENDER_EMAIL=your-email@gmail.com
SENDER_PASSWORD=your-app-password
SMTP_SERVER=smtp.gmail.com
SMTP_PORT=587

# Teams —Ç–æ—Ö–∏—Ä–≥–æ–æ (—Å–æ–Ω–≥–æ–ª—Ç)
TEAMS_WEBHOOK_URL=https://...

# RAG —Ç–æ—Ö–∏—Ä–≥–æ–æ
DOCS_BASE_URL=https://docs.cloud.mn

# JWT —Ç–æ—Ö–∏—Ä–≥–æ–æ
JWT_SECRET=your-secret-key
VERIFICATION_URL_BASE=http://localhost:5000
```

### 3. –ê–∂–∏–ª–ª—É—É–ª–∞—Ö

```bash
python main.py
```

## –°–∏—Å—Ç–µ–º–∏–π–Ω –∞–∂–∏–ª–ª–∞–≥–∞–∞

### 1. –•—ç—Ä—ç–≥–ª—ç–≥—á–∏–π–Ω –∞—Å—É—É–ª—Ç –∏—Ä—ç—Ö

```
Webhook ‚Üí –ë–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª–∞–ª—Ç —à–∞–ª–≥–∞—Ö ‚Üí –ê—Å—É—É–ª—Ç—ã–Ω —Ç”©—Ä”©–ª —Ç–æ–¥–æ—Ä—Ö–æ–π–ª–æ—Ö
```

### 2. –î–æ–∫—É–º–µ–Ω—Ç—ã–Ω –∞—Å—É—É–ª—Ç

```
RAG —Å–∏—Å—Ç–µ–º ‚Üí –î–æ–∫—É–º–µ–Ω—Ç —Ö–∞–π—Ö ‚Üí –•–∞—Ä–∏—É–ª—Ç + Sources ‚Üí Chatwoot
```

### 3. –ï—Ä”©–Ω—Ö–∏–π –∞—Å—É—É–ª—Ç

```
AI Assistant ‚Üí OpenAI API ‚Üí –•–∞—Ä–∏—É–ª—Ç ‚Üí Teams –º—ç–¥—ç—ç–ª—ç–ª ‚Üí Chatwoot
```

## RAG –°–∏—Å—Ç–µ–º–∏–π–Ω –±“Ø—Ç—ç—Ü

### –î–æ–∫—É–º–µ–Ω—Ç —Ü—É–≥–ª—É—É–ª–∞–ª—Ç

- BeautifulSoup –∞—à–∏–≥–ª–∞–Ω web scraping
- –ê–≤—Ç–æ–º–∞—Ç link –¥–∞–≥–∞–∂ —Ü—É–≥–ª—É—É–ª–∞—Ö
- Title –±–æ–ª–æ–Ω content —Ç—É—Å–≥–∞–∞—Ä–ª–∞—Ö

### Vector Store

- LangChain RecursiveCharacterTextSplitter
- OpenAI Embeddings
- FAISS –≤–µ–∫—Ç–æ—Ä—ã–Ω —Å–∞–Ω
- –î–∏—Å–∫—ç–Ω–¥ —Ö–∞–¥–≥–∞–ª–∞–≥–¥–∞—Ö

### –•–∞–π–ª—Ç—ã–Ω –º–µ—Ö–∞–Ω–∏–∑–º

- Similarity search
- Top 3 –¥–æ–∫—É–º–µ–Ω—Ç –æ–ª–æ—Ö
- Source metadata —Ö–∞–¥–≥–∞–ª–∞—Ö

## Teams –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏

### –ú—ç–¥—ç—ç–ª–ª–∏–π–Ω –¥“Ø—Ä“Ø“Ø–¥

- üìã –•—ç—Ä—ç–≥–ª—ç–≥—á–∏–π–Ω –∞—Å—É—É–¥–ª—ã–Ω –¥“Ø–≥–Ω—ç–ª—Ç
- ü§ñ AI —Å–∏—Å—Ç–µ–º –∞–ª–¥–∞–∞
- üîÑ Retry –±“Ø—Ç—ç–ª–≥“Ø–π—Ç—ç—Ö
- üìä –ê—Å—É—É–¥–ª—ã–Ω —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫

### Adaptive Cards —Ñ–æ—Ä–º–∞—Ç

- –¢–æ–¥–æ—Ä—Ö–æ–π –º—ç–¥—ç—ç–ª—ç–ª
- Chatwoot —Ä—É—É —à–∏–ª–∂–∏—Ö —Ç–æ–≤—á
- –¶–∞–≥ —Ö—É–≥–∞—Ü–∞–∞–Ω—ã —Ç—ç–º–¥—ç–≥

## –•—ç—Ä—ç–≥–ª—ç—ç–Ω–∏–π –∂–∏—à—ç—ç

### –î–æ–∫—É–º–µ–Ω—Ç—ã–Ω –∞—Å—É—É–ª—Ç

```
–•—ç—Ä—ç–≥–ª—ç–≥—á: "API —Ö—ç—Ä—Ö—ç–Ω –∞—à–∏–≥–ª–∞—Ö –≤—ç?"
‚Üí RAG —Å–∏—Å—Ç–µ–º –∞–∂–∏–ª–ª–∞–Ω–∞
‚Üí –î–æ–∫—É–º–µ–Ω—Ç–∞–∞—Å —Ö–∞–π–∂ –æ–ª–Ω–æ
‚Üí –•–∞—Ä–∏—É–ª—Ç + docs.cloud.mn links
```

### –ï—Ä”©–Ω—Ö–∏–π –∞—Å—É—É–ª—Ç

```
–•—ç—Ä—ç–≥–ª—ç–≥—á: "–°–∞–π–Ω –±–∞–π–Ω–∞ —É—É? –¢—É—Å–ª–∞–º–∂ —Ö—ç—Ä—ç–≥—Ç—ç–π –±–∞–π–Ω–∞"
‚Üí AI Assistant –∞–∂–∏–ª–ª–∞–Ω–∞
‚Üí OpenAI —Ö–∞—Ä–∏—É–ª—Ç
‚Üí Teams –º—ç–¥—ç—ç–ª—ç–ª –∏–ª–≥—ç—ç—Ö
```

## –ú–æ–Ω–∏—Ç–∏–Ω–≥

### Health Check

```bash
curl http://localhost:5000/health
```

### RAG —Ç–µ—Å—Ç

```bash
curl -X POST http://localhost:5000/docs-search \
  -H "Content-Type: application/json" \
  -d '{"question": "API documentation"}'
```

### Teams —Ç–µ—Å—Ç

```bash
curl http://localhost:5000/test-teams
```

## –°–∏—Å—Ç–µ–º–∏–π–Ω –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä

```
Chatwoot ‚Üí Flask Webhook ‚Üí Email Check ‚Üí Question Type
                                             ‚Üì
                              ‚îå‚îÄ RAG System (docs questions)
                              ‚îî‚îÄ AI Assistant (general questions)
                                             ‚Üì
                              Response ‚Üí Teams (if needed) ‚Üí Chatwoot
```

## –ê–Ω—Ö–∞–∞—Ä–∞—Ö –∑“Ø–π–ª—Å

1. **Vector Store** —ç—Ö–Ω–∏–π —É–¥–∞–∞ –±“Ø—Ç—ç—ç—Ö—ç–¥ —É–¥–∞–∞–Ω –±–æ–ª–Ω–æ
2. **OpenAI rate limits** –∞–Ω—Ö–∞–∞—Ä–∞—Ö
3. **Teams webhook** —Å–æ–Ω–≥–æ–≥–¥—Å–æ–Ω —Ç–æ—Ö–∏—Ä–≥–æ–æ
4. **Email SMTP** –∑”©–≤ —Ç–æ—Ö–∏—Ä—É—É–ª–∞—Ö —à–∞–∞—Ä–¥–ª–∞–≥–∞—Ç–∞–π
5. **DOCS_BASE_URL** –¥–æ–∫—É–º–µ–Ω—Ç—ã–Ω —Å–∞–π—Ç –±–∞–π—Ö —ë—Å—Ç–æ–π

## –•”©–≥–∂“Ø“Ø–ª—ç–ª—Ç

–°–∏—Å—Ç–µ–º–∏–π–≥ —Ö”©–≥–∂“Ø“Ø–ª—ç—Ö–∏–π–Ω —Ç—É–ª–¥:

- –®–∏–Ω—ç –¥–æ–∫—É–º–µ–Ω—Ç—ã–Ω —Å–∞–π—Ç –Ω—ç–º—ç—Ö
- RAG prompt —Å–∞–π–∂—Ä—É—É–ª–∞—Ö
- Teams notification —Ñ–æ—Ä–º–∞—Ç—ã–≥ ”©”©—Ä—á–ª”©—Ö
- Monitoring –Ω—ç–º—ç—Ö

---

**–ê–Ω—Ö–∞–∞—Ä–∞—Ö:** –≠–Ω—ç —Å–∏—Å—Ç–µ–º production –æ—Ä—á–∏–Ω–¥ –∞—à–∏–≥–ª–∞—Ö—ã–Ω ”©–º–Ω”© –±“Ø—Ö —Ç–æ—Ö–∏—Ä–≥–æ–æ–≥ —Å–∞–π—Ç–∞—Ä —à–∞–ª–≥–∞–Ω–∞ —É—É.

# Chatwoot AI Chatbot with Smart Topic Tracking

–≠–Ω—ç –±–æ–ª Chatwoot-—Ç–æ–π —Ö–æ–ª–±–æ–≥–¥—Å–æ–Ω —É—Ö–∞–∞–ª–∞–≥ AI chatbot —Å–∏—Å—Ç–µ–º —é–º. –¢—É—Å —Å–∏—Å—Ç–µ–º –Ω—å —Ö—ç—Ä—ç–≥–ª—ç–≥—á–∏–π–Ω –∞—Å—É—É–¥–ª—ã–≥ —É—Ö–∞–∞–ª–∞–≥ –±–∞–π–¥–ª–∞–∞—Ä tracking —Ö–∏–π–∂, RAG —Å–∏—Å—Ç–µ–º—ç—ç—Ä —Ö–∞—Ä–∏—É–ª–¥–∞–≥.

## üéØ “Æ–Ω–¥—Å—ç–Ω –æ–Ω—Ü–ª–æ–≥—É—É–¥

### üìö RAG (Retrieval-Augmented Generation) –°–∏—Å—Ç–µ–º

- –î–æ–∫—É–º–µ–Ω—Ç —Å–∞–π—Ç–∞–∞—Å –∞–≤—Ç–æ–º–∞—Ç –º—ç–¥—ç—ç–ª—ç–ª —Ü—É–≥–ª—É—É–ª–∞—Ö
- Vector store-–æ–æ—Ä —Ö—É—Ä–¥–∞–Ω —Ö–∞–π–ª—Ç —Ö–∏–π—Ö
- –•–æ–ª–±–æ–≥–¥–æ—Ö —ç—Ö —Å—É—Ä–≤–∞–ª–∂—Ç–∞–π —Ö–∞—Ä–∏—É–ª—Ç ”©–≥”©—Ö

### üß† –ê—Å—É—É–¥–∞–ª Tracking –°–∏—Å—Ç–µ–º–∞ (Topic Tracking)

- **–®–∏–Ω—ç –∞—Å—É—É–¥–∞–ª**: RAG —Å–∏—Å—Ç–µ–º—ç—ç—Ä —ç—Ö–ª—ç—ç–¥ —Ö–∞–π—Ö
- **–•—É—É—á–∏–Ω –∞—Å—É—É–¥–ª—ã–Ω “Ø—Ä–≥—ç–ª–∂–ª—ç–ª**: RAG-–∞–∞—Ä —Ö–∞—Ä–∏—É–ª—Å–∞–Ω –∞—Å—É—É–¥–ª—ã–Ω —Ç–∞–ª–∞–∞—Ä –¥–∞—Ö–∏–Ω –∞—Å—É—É–≤–∞–ª –¥—ç–º–∂–ª—ç–≥–∏–π–Ω –±–∞–≥—Ç —à–∏–ª–∂“Ø“Ø–ª—ç—Ö
- **AI Assistant fallback**: RAG –æ–ª–æ—Ö–≥“Ø–π –±–æ–ª —Å—Ç–∞–Ω–¥–∞—Ä—Ç AI Assistant –∞—à–∏–≥–ª–∞—Ö

### üìß –ò–º—ç–π–ª –±–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª–∞–ª—Ç

- –•—ç—Ä—ç–≥–ª—ç–≥—á —ç—Ö–ª—ç—ç–¥ –∏–º—ç–π–ª—ç—ç –±–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª–∞—Ö —à–∞–∞—Ä–¥–ª–∞–≥–∞—Ç–∞–π
- JWT —Ç–æ–∫–µ–Ω –∞—à–∏–≥–ª–∞–Ω –∞—é—É–ª–≥“Ø–π verification
- 24 —Ü–∞–≥–∏–π–Ω —Ö—É–≥–∞—Ü–∞–∞—Ç–∞–π —Ç–æ–∫–µ–Ω

### üìû Teams –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏

- –ê—Å—É—É–¥–∞–ª escalate —Ö–∏–π—Ö—ç–¥ Teams-—ç—ç—Ä –º—ç–¥—ç—ç–ª—ç—Ö
- –•—ç—Ä—ç–≥–ª—ç–≥—á–∏–π–Ω –∞—Å—É—É–¥–ª—ã–Ω AI –∞–Ω–∞–ª–∏–∑
- –î—ç–ª–≥—ç—Ä—ç–Ω–≥“Ø–π –º—ç–¥—ç—ç–ª—ç–ª—Ç—ç–π notification

## üöÄ –ê–∂–∏–ª–ª–∞—Ö –ª–æ–≥–∏–∫

### 1. –ò–º—ç–π–ª –±–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª–∞–ª—Ç

```
–•—ç—Ä—ç–≥–ª—ç–≥—á –º–µ—Å—Å–µ–∂ –∏–ª–≥—ç—ç—Ö
‚Üì
–ò–º—ç–π–ª –±–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª—Å–∞–Ω —ç—Å—ç—Ö–∏–π–≥ —à–∞–ª–≥–∞—Ö
‚Üì
–•—ç—Ä—ç–≤ “Ø–≥“Ø–π –±–æ–ª –∏–º—ç–π–ª —Ö–∞—è–≥ –∞—Å—É—É—Ö
‚Üì
–ò–º—ç–π–ª –∏–ª–≥—ç—ç–∂, –±–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª–∞—Ö –ª–∏–Ω–∫ –∏–ª–≥—ç—ç—Ö
```

### 2. –ê—Å—É—É–¥–∞–ª –±–æ–ª–æ–≤—Å—Ä—É—É–ª–∞—Ö

#### –®–∏–Ω—ç –∞—Å—É—É–¥–∞–ª:

```
–®–∏–Ω—ç –∞—Å—É—É–¥–∞–ª –∏–ª—Ä—ç—Ö
‚Üì
RAG —Å–∏—Å—Ç–µ–º—ç—ç—Ä –¥–æ–∫—É–º–µ–Ω—Ç —Ö–∞–π—Ö
‚Üì
–•—ç—Ä—ç–≤ –æ–ª–¥–≤–æ–ª: RAG —Ö–∞—Ä–∏—É–ª—Ç + topic state —Ö–∞–¥–≥–∞–ª–∞—Ö
‚Üì
–•—ç—Ä—ç–≤ –æ–ª–¥–æ—Ö–≥“Ø–π –±–æ–ª: AI Assistant —Ä—É—É —è–≤—É—É–ª–∞—Ö
```

#### –•—É—É—á–∏–Ω –∞—Å—É—É–¥–ª—ã–Ω “Ø—Ä–≥—ç–ª–∂–ª—ç–ª:

```
”®–º–Ω”©—Ö –∞—Å—É—É–¥–∞–ª—Ç–∞–π —Ö–æ–ª–±–æ–æ—Ç–æ–π –∞—Å—É—É–ª—Ç
‚Üì
RAG-–∞–∞—Ä —Ö–∞—Ä–∏—É–ª—Å–∞–Ω –∞—Å—É—É–¥–∞–ª —ç—Å—ç—Ö–∏–π–≥ —à–∞–ª–≥–∞—Ö
‚Üì
–•—ç—Ä—ç–≤ —Ç–∏–π–º –±–æ–ª: Teams-–¥ escalate —Ö–∏–π—Ö
‚Üì
–•—ç—Ä—ç–≤ “Ø–≥“Ø–π –±–æ–ª: AI Assistant –∞—à–∏–≥–ª–∞—Ö
```

## üîß –¢–æ—Ö–∏—Ä–≥–æ–æ

### –û—Ä—á–Ω—ã —Ö—É–≤—å—Å–∞–≥—á–∏–¥ (Environment Variables)

```bash
# OpenAI
OPENAI_API_KEY=your_openai_api_key
ASSISTANT_ID=your_assistant_id

# Chatwoot
CHATWOOT_API_KEY=your_chatwoot_api_key
ACCOUNT_ID=your_account_id

# Email (SMTP)
SENDER_EMAIL=your_email@domain.com
SENDER_PASSWORD=your_app_password
SMTP_SERVER=smtp.gmail.com
SMTP_PORT=587

# Teams
TEAMS_WEBHOOK_URL=your_teams_webhook_url

# RAG
DOCS_BASE_URL=https://docs.cloud.mn

# JWT
JWT_SECRET=your_secret_key
VERIFICATION_URL_BASE=http://localhost:5000
```

### –°—É—É–ª–≥–∞—Ö

```bash
# Dependencies —Å—É—É–ª–≥–∞—Ö
pip install -r requirements.txt

# RAG –¥–æ–∫—É–º–µ–Ω—Ç —Ü—É–≥–ª—É—É–ª–∞—Ö (—ç—Ö–Ω–∏–π —É–¥–∞–∞)
python main.py  # Vector store –∞–≤—Ç–æ–º–∞—Ç “Ø“Ø—Å–Ω—ç

# –°–µ—Ä–≤–µ—Ä–∏–π–≥ –∞–∂–∏–ª–ª—É—É–ª–∞—Ö
python main.py
```

## üìã API Endpoints

### “Æ–Ω–¥—Å—ç–Ω endpoints

- `POST /webhook` - Chatwoot webhook handler
- `GET /verify?token=<token>` - –ò–º—ç–π–ª –±–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª–∞—Ö
- `GET /health` - –°–∏—Å—Ç–µ–º–∏–π–Ω —Ç”©–ª”©–≤

### –î–æ–∫—É–º–µ–Ω—Ç endpoints

- `POST /docs-search` - RAG —Å–∏—Å—Ç–µ–º—ç—ç—Ä –¥–æ–∫—É–º–µ–Ω—Ç —Ö–∞–π—Ö
- `POST /rebuild-docs` - Vector store –¥–∞—Ö–∏–Ω –±“Ø—Ç—ç—ç—Ö

### –¢–µ—Å—Ç endpoints

- `POST /test-email` - –ò–º—ç–π–ª —Å–∏—Å—Ç–µ–º–∏–π–≥ —Ç–µ—Å—Ç —Ö–∏–π—Ö
- `POST /test-topic` - –ê—Å—É—É–¥–∞–ª tracking —Å–∏—Å—Ç–µ–º–∏–π–≥ —Ç–µ—Å—Ç —Ö–∏–π—Ö

## üß™ –¢–µ—Å—Ç–ª—ç—Ö

### –ò–º—ç–π–ª —Ç–µ—Å—Ç

```bash
curl -X POST http://localhost:5000/test-email \
  -H "Content-Type: application/json" \
  -d '{"email": "test@example.com"}'
```

### Topic tracking —Ç–µ—Å—Ç

```bash
curl -X POST http://localhost:5000/test-topic \
  -H "Content-Type: application/json" \
  -d '{
    "conv_id": 123,
    "contact_id": 456,
    "message": "CloudMN-–∏–π —Ç—É—Ö–∞–π –º—ç–¥—ç—ç–ª—ç–ª –∞–≤–º–∞–∞—Ä –±–∞–π–Ω–∞"
  }'
```

### RAG —Ö–∞–π–ª—Ç —Ç–µ—Å—Ç

```bash
curl -X POST http://localhost:5000/docs-search \
  -H "Content-Type: application/json" \
  -d '{"question": "CloudMN —Ö—ç—Ä—Ö—ç–Ω –∞—à–∏–≥–ª–∞—Ö –≤—ç?"}'
```

## üîÑ –ê—Å—É—É–¥–∞–ª Tracking Workflow

### Custom Attributes (Conversation level)

- `current_topic` - –û–¥–æ–æ–≥–∏–π–Ω –∞—Å—É—É–¥–ª—ã–Ω —Ç–æ–≤—á –∞–≥—É—É–ª–≥–∞
- `topic_handled_by_rag` - RAG —Å–∏—Å—Ç–µ–º—ç—ç—Ä —Ö–∞—Ä–∏—É–ª—Å–∞–Ω —ç—Å—ç—Ö
- `last_rag_attempt` - –°“Ø“Ø–ª–∏–π–Ω RAG –æ—Ä–æ–ª–¥–ª–æ–≥—ã–Ω —Ö—É–≥–∞—Ü–∞–∞
- `escalated_to_support` - –î—ç–º–∂–ª—ç–≥–∏–π–Ω –±–∞–≥—Ç —à–∏–ª–∂“Ø“Ø–ª—Å—ç–Ω —ç—Å—ç—Ö
- `topic_created_at` - –ê—Å—É—É–¥–∞–ª “Ø“Ø—Å—Å—ç–Ω —Ö—É–≥–∞—Ü–∞–∞

### Contact Attributes

- `email_verified` - –ò–º—ç–π–ª –±–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª—Å–∞–Ω —ç—Å—ç—Ö
- `verified_email` - –ë–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª—Å–∞–Ω –∏–º—ç–π–ª —Ö–∞—è–≥
- `verification_date` - –ë–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª—Å–∞–Ω —Ö—É–≥–∞—Ü–∞–∞

## üìä –õ–æ–≥–∏—á–Ω—ã –∂–∏—à—ç—ç

```
üë§ –•—ç—Ä—ç–≥–ª—ç–≥—á: "CloudMN-–¥ —Ö—ç—Ä—Ö—ç–Ω —Ñ–∞–π–ª —Ö—É—É–ª–∞—Ö –≤—ç?"
ü§ñ –°–∏—Å—Ç–µ–º: [–®–∏–Ω—ç –∞—Å—É—É–¥–∞–ª] ‚Üí RAG —Ö–∞–π–ª—Ç ‚Üí –•–∞—Ä–∏—É–ª—Ç –æ–ª–¥–ª–æ–æ
üìù State: topic="CloudMN —Ñ–∞–π–ª —Ö—É—É–ª–∞—Ö", rag_handled=true

üë§ –•—ç—Ä—ç–≥–ª—ç–≥—á: "–•—ç–¥–∏–π–Ω —Ö—ç–º–∂—ç—ç–Ω–∏–π —Ñ–∞–π–ª —Ö—É—É–ª–∂ –±–æ–ª–æ—Ö –≤—ç?"
ü§ñ –°–∏—Å—Ç–µ–º: [–•–æ–ª–±–æ–æ—Ç–æ–π –∞—Å—É—É–ª—Ç] ‚Üí RAG handled ‚Üí Teams-–¥ —à–∏–ª–∂“Ø“Ø–ª—ç—Ö
üìû Teams: "RAG-–∞–∞—Ä —Ö–∞—Ä–∏—É–ª—Å–∞–Ω –∞—Å—É—É–¥–ª—ã–Ω “Ø—Ä–≥—ç–ª–∂–ª—ç–ª"

üë§ –•—ç—Ä—ç–≥–ª—ç–≥—á: "Pricing-–∏–π–Ω —Ç–∞–ª–∞–∞—Ä –º—ç–¥—ç—ç–ª—ç–ª ”©–≥–Ω”© “Ø“Ø?"
ü§ñ –°–∏—Å—Ç–µ–º: [–®–∏–Ω—ç –∞—Å—É—É–¥–∞–ª] ‚Üí RAG —Ö–∞–π–ª—Ç ‚Üí –•–∞—Ä–∏—É–ª—Ç –æ–ª–¥–ª–æ–æ
üìù State: topic="Pricing –º—ç–¥—ç—ç–ª—ç–ª", rag_handled=true (—à–∏–Ω—ç topic)
```

## üîç Debug –±–æ–ª–æ–Ω –∞–ª–¥–∞–∞ –∑–∞—Å–∞—Ö

### –õ–æ–≥–∏–π–≥ “Ø–∑—ç—Ö

–ö–æ–Ω—Å–æ–ª –¥—ç—ç—Ä –¥—ç–ª–≥—ç—Ä—ç–Ω–≥“Ø–π –ª–æ–≥ —Ö–∞—Ä–∞–≥–¥–∞–Ω–∞:

```
üîç –ê—Å—É—É–¥–ª—ã–Ω —Ç”©–ª”©–≤ —à–∞–ª–≥–∞–∂ –±–∞–π–Ω–∞...
üìä –ê—Å—É—É–¥–ª—ã–Ω —Ç”©–ª”©–≤: topic='CloudMN —Ñ–∞–π–ª', rag_handled=true, escalated=false
üÜï –ê—Å—É—É–¥–ª—ã–Ω —à–∏–Ω–∂–∏–ª–≥—ç—ç: AI: ”®–º–Ω”©—Ö –∞—Å—É—É–¥–∞–ª—Ç–∞–π —Ö–æ–ª–±–æ–æ—Ç–æ–π
üìû RAG-–∞–∞—Ä —Ö–∞—Ä–∏—É–ª—Å–∞–Ω –∞—Å—É—É–¥–ª—ã–Ω “Ø—Ä–≥—ç–ª–∂–ª—ç–ª - –¥—ç–º–∂–ª—ç–≥–∏–π–Ω –±–∞–≥—Ç —à–∏–ª–∂“Ø“Ø–ª–∂ –±–∞–π–Ω–∞
```

### –ê–ª–¥–∞–∞ –≥–∞—Ä—Å–∞–Ω “Ø–µ–¥

1. `/health` endpoint-—ç—ç—Ä —Å–∏—Å—Ç–µ–º–∏–π–Ω —Ç”©–ª”©–≤ —à–∞–ª–≥–∞—Ö
2. `/test-email` endpoint-—ç—ç—Ä –∏–º—ç–π–ª —Å–∏—Å—Ç–µ–º–∏–π–≥ —à–∞–ª–≥–∞—Ö
3. `/test-topic` endpoint-—ç—ç—Ä tracking —Å–∏—Å—Ç–µ–º–∏–π–≥ —à–∞–ª–≥–∞—Ö
4. Logs-–æ–æ—Å –¥—ç–ª–≥—ç—Ä—ç–Ω–≥“Ø–π –∞–ª–¥–∞–∞–Ω—ã –º—ç–¥—ç—ç–ª—ç–ª –∞–≤–∞—Ö

## üö® –ê–Ω—Ö–∞–∞—Ä–∞—Ö –∑“Ø–π–ª“Ø“Ø–¥

- –ò–º—ç–π–ª –±–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª–∞–ª—Ç–≥“Ø–π–≥—ç—ç—Ä chatbot –∞—à–∏–≥–ª–∞—Ö –±–æ–ª–æ–º–∂–≥“Ø–π
- RAG —Å–∏—Å—Ç–µ–º –¥–æ–∫—É–º–µ–Ω—Ç —Å–∞–π—Ç –¥–æ—Å—Ç—É–ø –±–∞–π—Ö —à–∞–∞—Ä–¥–ª–∞–≥–∞—Ç–∞–π
- Teams webhook —Ç–æ—Ö–∏—Ä—É—É–ª–∞–∞–≥“Ø–π –±–æ–ª escalation –∞–∂–∏–ª–ª–∞—Ö–≥“Ø–π
- JWT —Ç–æ–∫–µ–Ω 24 —Ü–∞–≥–∏–π–Ω –¥–∞—Ä–∞–∞ —Ö“Ø—á–∏–Ω–≥“Ø–π –±–æ–ª–Ω–æ

## üõ†Ô∏è –•”©–≥–∂“Ø“Ø–ª—ç–ª—Ç

–°–∏—Å—Ç–µ–º–∏–π–≥ extended —Ö–∏–π—Ö–∏–π–Ω —Ç—É–ª–¥:

1. –®–∏–Ω—ç –¥–æ–∫—É–º–µ–Ω—Ç —ç—Ö —Å—É—Ä–≤–∞–ª–∂ –Ω—ç–º—ç—Ö (`DOCS_BASE_URL` ”©”©—Ä—á–ª”©—Ö)
2. Custom topic –∞–Ω–∞–ª–∏–∑ –ª–æ–≥–∏–∫ –Ω—ç–º—ç—Ö (`is_new_topic` —Ñ—É–Ω–∫—Ü)
3. –ù—ç–º—ç–ª—Ç escalation —à–∞–ª–≥—É—É—Ä –Ω—ç–º—ç—Ö
4. Teams-—ç—ç—Å ”©”©—Ä notification —Å–∏—Å—Ç–µ–º –∞—à–∏–≥–ª–∞—Ö

---

**–•”©–≥–∂“Ø“Ø–ª—Å—ç–Ω:** AI Assistant with Topic Tracking  
**–û–≥–Ω–æ–æ:** 2024  
**–•—É–≤–∏–ª–±–∞—Ä:** 2.0

# Chatwoot-OpenAI Integration with RAG Support

–≠–Ω—ç —Å–∏—Å—Ç–µ–º –Ω—å Chatwoot chat –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã–≥ OpenAI Assistant API –±–æ–ª–æ–Ω RAG (Retrieval-Augmented Generation) —Å–∏—Å—Ç–µ–º—Ç—ç–π —Ö–æ–ª–±–æ–∂, —Ö—ç—Ä—ç–≥–ª—ç–≥—á–¥–∏–π–Ω –∞—Å—É—É–ª—Ç–∞–Ω–¥ –∞–≤—Ç–æ–º–∞—Ç —Ö–∞—Ä–∏—É–ª–∞—Ö –∑–æ—Ä–∏–ª–≥–æ—Ç–æ–π.

## üéØ –°–∏—Å—Ç–µ–º–∏–π–Ω “Ø–Ω–¥—Å—ç–Ω –æ–Ω—Ü–ª–æ–≥—É—É–¥

### 1. RAG-–±–∞–∞–∑ —Ö–∞—Ä–∏—É–ª—Ç —Å–∏—Å—Ç–µ–º

- **–ë“Ø—Ö –∞—Å—É—É–ª—Ç—ã–≥ —ç—Ö–ª—ç—ç–¥ RAG —Å–∏—Å—Ç–µ–º—ç—ç—Ä —Ö–∞–π—Ö**
- –•—ç—Ä—ç–≥–ª—ç–≥—á–∏–π–Ω –∞—Å—É—É–ª—Ç–∞–¥ —Ö–æ–ª–±–æ–≥–¥–æ—Ö –±–∞—Ä–∏–º—Ç –±–∏—á–≥–∏–π–≥ vector database-–∞–∞—Å —Ö–∞–π–∂ –æ–ª–æ—Ö
- –û–ª–¥—Å–æ–Ω –±–∞—Ä–∏–º—Ç –±–∏—á–≥–∏–π–≥ –∞—à–∏–≥–ª–∞–Ω –Ω–∞—Ä–∏–π–≤—á–∏–ª—Å–∞–Ω —Ö–∞—Ä–∏—É–ª—Ç “Ø“Ø—Å–≥—ç—Ö
- –•—ç—Ä—ç–≤ RAG —Å–∏—Å—Ç–µ–º–¥ —Ö–∞—Ä–∏—É–ª—Ç –æ–ª–¥–æ—Ö–≥“Ø–π –±–æ–ª AI Assistant —Ä—É—É —à–∏–ª–∂“Ø“Ø–ª—ç—Ö

### 2. –ê—Å—É—É–¥–∞–ª Tracking & Escalation Confirmation

- **–ê—Å—É—É–¥–∞–ª –±“Ø—Ä–∏–π–≥ –∑”©–≤—Ö”©–Ω –Ω—ç–≥ —É–¥–∞–∞ RAG-–∞–∞—Å —Ö–∞–π—Ö**
- RAG-–∞–∞—Ä —Ö–∞—Ä–∏—É–ª—Å–∞–Ω –∞—Å—É—É–¥–ª—ã–Ω “Ø—Ä–≥—ç–ª–∂–ª—ç–ª –∞—Å—É—É–ª—Ç –∏—Ä—ç—Ö—ç–¥ **—Ö—ç—Ä—ç–≥–ª—ç–≥—á—ç—ç—Å –∑”©–≤—à”©”©—Ä”©–ª –∞—Å—É—É—Ö**
- –•—ç—Ä—ç–≥–ª—ç–≥—á–∏–π–Ω –∑”©–≤—à”©”©—Ä–ª”©”©—Ä –¥—ç–º–∂–ª—ç–≥–∏–π–Ω –±–∞–≥—Ç —à–∏–ª–∂“Ø“Ø–ª—ç—Ö
- Conversation-–∏–π –∞—Å—É—É–¥–ª—ã–Ω —Ç”©–ª”©–≤–∏–π–≥ —Ö–∞–¥–≥–∞–ª–∞—Ö —Å–∏—Å—Ç–µ–º—Ç—ç–π

### 3. –ò–º—ç–π–ª –±–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª–∞–ª—Ç—ã–Ω —Å–∏—Å—Ç–µ–º

- –•—ç—Ä—ç–≥–ª—ç–≥—á–∏–π–Ω –∏–º—ç–π–ª–∏–π–≥ –±–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª–∞—Ö –ø—Ä–æ—Ü–µ—Å—Å
- –ë–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª–∞–ª—Ç—ã–Ω —Ç–æ–∫–µ–Ω —Å–∏—Å—Ç–µ–º
- –ó”©–≤—Ö”©–Ω –±–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª—Å–∞–Ω –∏–º—ç–π–ª—Ç—ç–π —Ö—ç—Ä—ç–≥–ª—ç–≥—á–¥–∏–π–Ω –∞—Å—É—É–ª—Ç–∞–Ω–¥ —Ö–∞—Ä–∏—É–ª–∞—Ö

### 4. Teams –º—ç–¥—ç–≥–¥—ç–ª —Å–∏—Å—Ç–µ–º

- AI —Å–∏—Å—Ç–µ–º–∏–π–Ω –∞–ª–¥–∞–∞ –±–æ–ª–æ–Ω escalation-–∏–π–Ω “Ø–µ–¥ –∞–≤—Ç–æ–º–∞—Ç Teams –º—ç–¥—ç–≥–¥—ç–ª
- –ê—Å—É—É–¥–ª—ã–Ω –Ω–∞—Ä–∏–π–≤—á–∏–ª—Å–∞–Ω –¥“Ø–Ω —à–∏–Ω–∂–∏–ª–≥—ç—ç
- –•—ç—Ä—ç–≥–ª—ç–≥—á–∏–π–Ω –º—ç–¥—ç—ç–ª—ç–ª –±–æ–ª–æ–Ω conversation –∫–æ–Ω—Ç–µ–∫—Å—Ç

## üîÑ –°–∏—Å—Ç–µ–º –∞–∂–∏–ª–ª–∞—Ö –ª–æ–≥–∏–∫

### –®–∏–Ω—ç –∞—Å—É—É–ª—Ç –∏—Ä—ç—Ö “Ø–µ–¥:

1. **–ò–º—ç–π–ª –±–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª–∞–ª—Ç —à–∞–ª–≥–∞—Ö**
2. **RAG —Å–∏—Å—Ç–µ–º—ç—ç—Ä —Ö–∞–π—Ö**
   - –û–ª–¥–≤–æ–ª: RAG —Ö–∞—Ä–∏—É–ª—Ç ”©–≥”©—Ö + –∞—Å—É—É–¥–ª—ã–Ω —Ç”©–ª”©–≤ —Ö–∞–¥–≥–∞–ª–∞—Ö
   - –û–ª–¥–æ—Ö–≥“Ø–π: AI Assistant —Ä—É—É —à–∏–ª–∂“Ø“Ø–ª—ç—Ö

### ”®–º–Ω”©—Ö –∞—Å—É—É–¥–ª—ã–Ω “Ø—Ä–≥—ç–ª–∂–ª—ç–ª –∏—Ä—ç—Ö “Ø–µ–¥:

1. **RAG-–∞–∞—Ä —Ö–∞—Ä–∏—É–ª—Å–∞–Ω –∞—Å—É—É–¥–ª—ã–Ω “Ø—Ä–≥—ç–ª–∂–ª—ç–ª –±–æ–ª:**

   - üÜï **–•—ç—Ä—ç–≥–ª—ç–≥—á—ç—ç—Å escalation –∑”©–≤—à”©”©—Ä”©–ª –∞—Å—É—É—Ö**
   - –ó”©–≤—à”©”©—Ä—Å”©–Ω: Teams-–¥ –¥–∞–º–∂—É—É–ª–∞—Ö
   - –¢–∞—Ç–≥–∞–ª–∑—Å–∞–Ω: AI Assistant –∞—à–∏–≥–ª–∞—Ö
   - –¢–æ–¥–æ—Ä—Ö–æ–π–≥“Ø–π: –¢–æ–¥—Ä—É—É–ª–∞—Ö –∞—Å—É—É–ª—Ç –∞—Å—É—É—Ö

2. **RAG –±“Ø—Ç—ç–ª–≥“Ø–π—Ç—Å—ç–Ω –∞—Å—É—É–¥–ª—ã–Ω “Ø—Ä–≥—ç–ª–∂–ª—ç–ª –±–æ–ª:**

   - AI Assistant –∞—à–∏–≥–ª–∞—Ö

3. **–ê–ª—å —Ö—ç–¥–∏–π–Ω escalate —Ö–∏–π—Å—ç–Ω –±–æ–ª:**
   - "–ê–ª—å —Ö—ç–¥–∏–π–Ω –¥–∞–º–∂—É—É–ª—Å–∞–Ω" –º–µ—Å—Å–µ–∂

### Escalation –∑”©–≤—à”©”©—Ä–ª–∏–π–Ω —Å–∏—Å—Ç–µ–º:

```
–•—ç—Ä—ç–≥–ª—ç–≥—á: "–ì—ç—Ö–¥—ç—ç —ç–Ω—ç —Ç–æ—Ö–∏—Ä–≥–æ–æ –∞–ª–¥–∞–∞—Ç–∞–π –±–∞–π–Ω–∞"
–°–∏—Å—Ç–µ–º:
"ü§î –¢–∞–Ω–∞–π –∞—Å—É—É–ª—Ç –Ω—ç–º—ç–ª—Ç —Ç–µ—Ö–Ω–∏–∫–∏–π–Ω –¥—ç–º–∂–ª—ç–≥ —à–∞–∞—Ä–¥–∞–∂ –±–∞–π–Ω–∞.

–ë–∏ —Ç–∞–Ω—ã –∞—Å—É—É–ª—Ç—ã–≥ –º–∞–Ω–∞–π –¥—ç–º–∂–ª—ç–≥–∏–π–Ω –º—ç—Ä–≥—ç–∂–∏–ª—Ç—ç–Ω–¥ –¥–∞–º–∂—É—É–ª–∂ –±–æ–ª–æ—Ö —É—É?

‚úÖ –¢–∏–π–º - –¥—ç–º–∂–ª—ç–≥–∏–π–Ω –±–∞–≥—Ç –¥–∞–º–∂—É—É–ª–∞—Ö
‚ùå “Æ–≥“Ø–π - –±–∏ ”©”©—Ä”©”© —à–∏–π–¥—ç–∂ “Ø–∑—å–µ

–ú”©–Ω ”©”©—Ä –∞—Å—É—É–ª—Ç –±–∞–π–≥–∞–∞ —ç—Å—ç—Ö–∏–π–≥ –º—ç–¥—ç—ç–ª—ç—ç—Ä—ç–π:"
```

## üìö API Endpoints

### “Æ–Ω–¥—Å—ç–Ω Endpoints:

- `POST /webhook` - Chatwoot webhook handler
- `GET /verify` - –ò–º—ç–π–ª –±–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª–∞–ª—Ç
- `POST /docs-search` - RAG —Ö–∞–π–ª—Ç
- `GET /health` - –°–∏—Å—Ç–µ–º–∏–π–Ω —Å—Ç–∞—Ç—É—Å
- `POST /rebuild-docs` - Vector store –¥–∞—Ö–∏–Ω –±“Ø—Ç—ç—ç—Ö

### üÜï –¢–µ—Å—Ç Endpoints:

- `POST /test-email` - –ò–º—ç–π–ª —Å–∏—Å—Ç–µ–º–∏–π–≥ —Ç–µ—Å—Ç
- `POST /test-topic` - –ê—Å—É—É–¥–∞–ª tracking —Ç–µ—Å—Ç
- `POST /test-escalation` - **Escalation confirmation —Ç–µ—Å—Ç**

### Test Escalation Endpoint –∞—à–∏–≥–ª–∞—Ö:

```bash
# Escalation –∑”©–≤—à”©”©—Ä”©–ª –∞—Å—É—É—Ö —Ç–µ—Å—Ç
curl -X POST http://localhost:5000/test-escalation \
  -H "Content-Type: application/json" \
  -d '{
    "action": "request",
    "conv_id": 12345,
    "contact_id": 67890
  }'

# –ó”©–≤—à”©”©—Ä”©—Ö —Ç–µ—Å—Ç
curl -X POST http://localhost:5000/test-escalation \
  -H "Content-Type: application/json" \
  -d '{
    "action": "approve",
    "conv_id": 12345,
    "contact_id": 67890
  }'

# –¢–∞—Ç–≥–∞–ª–∑–∞—Ö —Ç–µ—Å—Ç
curl -X POST http://localhost:5000/test-escalation \
  -H "Content-Type: application/json" \
  -d '{
    "action": "reject",
    "conv_id": 12345,
    "contact_id": 67890
  }'

# –¢–æ–¥–æ—Ä—Ö–æ–π–≥“Ø–π —Ö–∞—Ä–∏—É–ª—Ç —Ç–µ—Å—Ç
curl -X POST http://localhost:5000/test-escalation \
  -H "Content-Type: application/json" \
  -d '{
    "action": "unclear",
    "conv_id": 12345,
    "contact_id": 67890
  }'
```

## ‚öôÔ∏è –¢–æ—Ö–∏—Ä–≥–æ–æ

### Environment Variables

–î–∞—Ä–∞–∞—Ö environment variable-—É—É–¥ —à–∞–∞—Ä–¥–ª–∞–≥–∞—Ç–∞–π:

```bash
# OpenAI API
OPENAI_API_KEY=your_openai_api_key
ASSISTANT_ID=your_assistant_id

# Chatwoot API
CHATWOOT_API_KEY=your_chatwoot_api_key
ACCOUNT_ID=your_account_id
CHATWOOT_BASE_URL=https://your-chatwoot-instance.com

# Teams Webhook
TEAMS_WEBHOOK_URL=your_teams_webhook_url

# Email SMTP
SENDER_EMAIL=your_email@domain.com
SENDER_PASSWORD=your_app_password
SMTP_SERVER=smtp.gmail.com
SMTP_PORT=587

# RAG System
DOCS_BASE_URL=https://your-docs-url.com
VECTOR_STORE_PATH=./vector_store
OPENAI_EMBEDDING_MODEL=text-embedding-3-small
```

## üîÑ Conversation State Management

### Custom Attributes —Ö–∞–¥–≥–∞–ª–∞—Ö:

```python
{
    "current_topic": "–•—ç—Ä—ç–≥–ª—ç–≥—á–∏–π–Ω –æ–¥–æ–æ–≥–∏–π–Ω –∞—Å—É—É–¥–∞–ª",
    "topic_handled_by_rag": "true/false",
    "last_rag_attempt": "timestamp",
    "escalated_to_support": "true/false",
    "topic_created_at": "timestamp",
    "pending_escalation": "true/false",     # üÜï
    "escalation_reason": "escalation —à–∞–ª—Ç–≥–∞–∞–Ω",  # üÜï
    "waiting_for_user_response": "true/false"    # üÜï
}
```

### Escalation Confirmation Flow:

1. **RAG —Ö–∞—Ä–∏—É–ª—Å–∞–Ω –∞—Å—É—É–¥–ª—ã–Ω “Ø—Ä–≥—ç–ª–∂–ª—ç–ª –∏–ª—Ä—ç—Ö**
2. **`ask_user_for_escalation_permission()` –¥—É—É–¥–∞—Ö**
3. **Conversation state: `pending_escalation=true, waiting_for_user_response=true`**
4. **–•—ç—Ä—ç–≥–ª—ç–≥—á–∏–π–Ω —Ö–∞—Ä–∏—É–ª—Ç —Ö“Ø–ª—ç—ç—Ö**
5. **`handle_escalation_response()` —Ñ—É–Ω–∫—Ü—ç—ç—Ä –±–æ–ª–æ–≤—Å—Ä—É—É–ª–∞—Ö**
6. **–ó”©–≤—à”©”©—Ä”©–ª –∞–≤–∞—Ö/—Ç–∞—Ç–≥–∞–ª–∑–∞—Ö/—Ç–æ–¥—Ä—É—É–ª–∞—Ö**

## üêõ Debug & Logs

### –õ–æ–≥–∏–π–Ω —Ç“Ø–≤—à–∏–Ω–≥“Ø“Ø–¥:

- `üìß` - –ò–º—ç–π–ª verification
- `üìä` - –ê—Å—É—É–¥–ª—ã–Ω —Ç”©–ª”©–≤ –º—ç–¥—ç—ç–ª—ç–ª
- `üÜï` - –ê—Å—É—É–¥–ª—ã–Ω —à–∏–Ω–∂–∏–ª–≥—ç—ç
- `üîÑ` - **Escalation —Ç”©–ª”©–≤**
- `üìû` - Teams notification
- `ü§ñ` - AI Assistant
- `üíæ` - RAG —Å–∏—Å—Ç–µ–º

### Escalation Debug –∂–∏—à—ç—ç:

```
üìä –ê—Å—É—É–¥–ª—ã–Ω —Ç”©–ª”©–≤: topic='–¢–∞–Ω–∞–π –ø—Ä–æ–≥—Ä–∞–º', rag_handled=True, escalated=False
üîÑ Escalation —Ç”©–ª”©–≤: pending=False, waiting=False
üÜï –ê—Å—É—É–¥–ª—ã–Ω —à–∏–Ω–∂–∏–ª–≥—ç—ç: –•–æ–ª–±–æ–æ—Ç–æ–π –∞—Å—É—É–ª—Ç
üìû RAG-–∞–∞—Ä —Ö–∞—Ä–∏—É–ª—Å–∞–Ω –∞—Å—É—É–¥–ª—ã–Ω “Ø—Ä–≥—ç–ª–∂–ª—ç–ª - —Ö—ç—Ä—ç–≥–ª—ç–≥—á—ç—ç—Å –∑”©–≤—à”©”©—Ä”©–ª –∞—Å—É—É–∂ –±–∞–π–Ω–∞
‚úÖ –•—ç—Ä—ç–≥–ª—ç–≥—á—ç—ç—Å escalation –∑”©–≤—à”©”©—Ä”©–ª –∞—Å—É—É–ª–∞–∞ - —Ö–∞—Ä–∏—É–ª—Ç —Ö“Ø–ª—ç—ç–∂ –±–∞–π–Ω–∞
```

## üöÄ –ê–∂–∏–ª–ª—É—É–ª–∞—Ö

```bash
# Dependencies —Å—É—É–ª–≥–∞—Ö
pip install -r requirements.txt

# Environment variables —Ç–æ—Ö–∏—Ä—É—É–ª–∞—Ö
cp .env.example .env
# .env —Ñ–∞–π–ª–¥ ”©”©—Ä–∏–π–Ω —É—Ç–≥—É—É–¥—ã–≥ –æ—Ä—É—É–ª–∞—Ö

# –ê–∂–∏–ª–ª—É—É–ª–∞—Ö
python main.py
```

## üîÑ Workflow Summary

```mermaid
graph TD
    A[–•—ç—Ä—ç–≥–ª—ç–≥—á–∏–π–Ω –º–µ—Å—Å–µ–∂] --> B{–ò–º—ç–π–ª –±–∞—Ç–∞–ª–≥–∞–∞–∂—Å–∞–Ω?}
    B --> |“Æ–≥“Ø–π| C[–ò–º—ç–π–ª –±–∞—Ç–∞–ª–≥–∞–∞–∂—É—É–ª–∞–ª—Ç –∏–ª–≥—ç—ç—Ö]
    B --> |–¢–∏–π–º| D{Pending escalation?}
    D --> |–¢–∏–π–º| E[Escalation —Ö–∞—Ä–∏—É–ª—Ç –±–æ–ª–æ–≤—Å—Ä—É—É–ª–∞—Ö]
    D --> |“Æ–≥“Ø–π| F{–®–∏–Ω—ç –∞—Å—É—É–¥–∞–ª?}
    F --> |–¢–∏–π–º| G[RAG —Å–∏—Å—Ç–µ–º—ç—ç—Ä —Ö–∞–π—Ö]
    F --> |“Æ–≥“Ø–π| H{RAG —Ö–∞—Ä–∏—É–ª—Å–∞–Ω –∞—Å—É—É–¥–∞–ª?}
    G --> |–û–ª–¥—Å–æ–Ω| I[RAG —Ö–∞—Ä–∏—É–ª—Ç]
    G --> |–û–ª–¥–æ–æ–≥“Ø–π| J[AI Assistant]
    H --> |–¢–∏–π–º| K[üÜï Escalation –∑”©–≤—à”©”©—Ä”©–ª –∞—Å—É—É—Ö]
    H --> |“Æ–≥“Ø–π| J[AI Assistant]
    K --> L[–•—ç—Ä—ç–≥–ª—ç–≥—á–∏–π–Ω —Ö–∞—Ä–∏—É–ª—Ç —Ö“Ø–ª—ç—ç—Ö]
    E --> |–ó”©–≤—à”©”©—Ä—Å”©–Ω| M[Teams-–¥ –¥–∞–º–∂—É—É–ª–∞—Ö]
    E --> |–¢–∞—Ç–≥–∞–ª–∑—Å–∞–Ω| J[AI Assistant]
```

## üÜï –®–∏–Ω—ç –û–Ω—Ü–ª–æ–≥—É—É–¥ v2.0

### 1. Escalation Confirmation System

- –ê–≤—Ç–æ–º–∞—Ç Teams –∏–ª–≥—ç—ç—Ö–∏–π–Ω –æ—Ä–æ–Ω–¥ —Ö—ç—Ä—ç–≥–ª—ç–≥—á—ç—ç—Å –∑”©–≤—à”©”©—Ä”©–ª –∞—Å—É—É—Ö
- –•—ç—Ä—ç–≥–ª—ç–≥—á–∏–π–Ω —Å–æ–Ω–≥–æ–ª—Ç—ã–≥ —Ö“Ø–Ω–¥—ç—Ç–≥—ç—Ö approach
- "”®”©—Ä –∞—Å—É—É–ª—Ç –±–∞–π–≥–∞–∞ —ç—Å—ç—Ö" —à–∞–ª–≥–∞—Ö

### 2. Conversation State Tracking

- –ò–ª“Ø“Ø –Ω–∞—Ä–∏–π–≤—á–∏–ª—Å–∞–Ω state management
- Pending escalation states
- User response waiting states

### 3. Improved User Experience

- –¢–æ–¥–æ—Ä—Ö–æ–π choice –æ–ø—Ü—É—É–¥
- –•—ç—Ä—ç–≥–ª—ç–≥—á–∏–¥ –∏–ª“Ø“Ø —Ö—è–Ω–∞–ª—Ç ”©–≥”©—Ö
- Escalation-–∏–π–Ω —à–∞–ª—Ç–≥–∞–∞–Ω—ã–≥ —Ç–∞–π–ª–±–∞—Ä–ª–∞—Ö

–≠–Ω—ç —Å–∏—Å—Ç–µ–º—ç—ç—Ä —Ö—ç—Ä—ç–≥–ª—ç–≥—á ”©”©—Ä”©”© —à–∏–π–¥—ç—Ö –±–æ–ª–æ–º–∂—Ç–æ–π, –∑”©–≤—Ö”©–Ω —à–∞–∞—Ä–¥–ª–∞–≥–∞—Ç–∞–π “Ø–µ–¥ –¥—ç–º–∂–ª—ç–≥–∏–π–Ω –±–∞–≥—Ç —à–∏–ª–∂“Ø“Ø–ª—ç—Ö –±–æ–ª–æ–º–∂—Ç–æ–π –±–æ–ª–Ω–æ.
